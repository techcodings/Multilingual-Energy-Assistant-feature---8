{
  "version": 3,
  "sources": ["file:///D:/New%20folder/Multilingual-Energy-Assistant-feature-8-main/Multilingual-Energy-Assistant-feature-8-main/chatbot/netlify/functions/chatgpt.js"],
  "sourceRoot": "C:/Users/lmgou/AppData/Local/Temp/tmp-1420-KEFOEmZ8HO1P",
  "sourcesContent": ["// netlify/functions/chatgpt.js\n\nconst OPENAI_API_KEY = process.env.OPENAI_API_KEY;\n\nconst corsHeaders = {\n  \"Access-Control-Allow-Origin\": \"*\",\n  \"Access-Control-Allow-Headers\": \"Content-Type\",\n  \"Access-Control-Allow-Methods\": \"POST,OPTIONS\",\n};\n\nexport const handler = async (event) => {\n  // CORS preflight\n  if (event.httpMethod === \"OPTIONS\") {\n    return {\n      statusCode: 200,\n      headers: corsHeaders,\n      body: \"\",\n    };\n  }\n\n  if (event.httpMethod !== \"POST\") {\n    return {\n      statusCode: 405,\n      headers: corsHeaders,\n      body: JSON.stringify({ error: \"Method not allowed\" }),\n    };\n  }\n\n  if (!OPENAI_API_KEY) {\n    return {\n      statusCode: 500,\n      headers: corsHeaders,\n      body: JSON.stringify({\n        error:\n          \"Missing OPENAI_API_KEY env variable. Set it in .env (local) and in Netlify site settings.\",\n      }),\n    };\n  }\n\n  let body;\n  try {\n    body = JSON.parse(event.body || \"{}\");\n  } catch {\n    return {\n      statusCode: 400,\n      headers: corsHeaders,\n      body: JSON.stringify({ error: \"Invalid JSON body\" }),\n    };\n  }\n\n  const messages = body.messages || [];\n\n  try {\n    const openaiRes = await fetch(\n      \"https://api.openai.com/v1/chat/completions\",\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${OPENAI_API_KEY}`,\n        },\n        body: JSON.stringify({\n          model: \"gpt-4o-mini\",\n          messages,\n          max_tokens: 900,\n          temperature: 0.7,\n        }),\n      }\n    );\n\n    const rawText = await openaiRes.text();\n\n    if (!openaiRes.ok) {\n      console.error(\"OpenAI error:\", openaiRes.status, rawText);\n      return {\n        statusCode: openaiRes.status,\n        headers: corsHeaders,\n        body: rawText || JSON.stringify({ error: \"OpenAI error\" }),\n      };\n    }\n\n    let data;\n    try {\n      data = JSON.parse(rawText);\n    } catch (err) {\n      console.error(\"Error parsing OpenAI JSON:\", err, rawText);\n      return {\n        statusCode: 500,\n        headers: corsHeaders,\n        body: JSON.stringify({\n          error: \"Failed to parse OpenAI response JSON\",\n        }),\n      };\n    }\n\n    const text = data?.choices?.[0]?.message?.content || \"\";\n\n    return {\n      statusCode: 200,\n      headers: { \"Content-Type\": \"application/json\", ...corsHeaders },\n      body: JSON.stringify({ text }),\n    };\n  } catch (err) {\n    console.error(\"Function error:\", err);\n    return {\n      statusCode: 500,\n      headers: { \"Content-Type\": \"application/json\", ...corsHeaders },\n      body: JSON.stringify({\n        error: err.message || \"Server error in chatgpt function\",\n      }),\n    };\n  }\n};\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA,IAAM,iBAAiB,QAAQ,IAAI;AAEnC,IAAM,cAAc;AAAA,EAClB,+BAA+B;AAAA,EAC/B,gCAAgC;AAAA,EAChC,gCAAgC;AAClC;AAEO,IAAM,UAAU,OAAO,UAAU;AAEtC,MAAI,MAAM,eAAe,WAAW;AAClC,WAAO;AAAA,MACL,YAAY;AAAA,MACZ,SAAS;AAAA,MACT,MAAM;AAAA,IACR;AAAA,EACF;AAEA,MAAI,MAAM,eAAe,QAAQ;AAC/B,WAAO;AAAA,MACL,YAAY;AAAA,MACZ,SAAS;AAAA,MACT,MAAM,KAAK,UAAU,EAAE,OAAO,qBAAqB,CAAC;AAAA,IACtD;AAAA,EACF;AAEA,MAAI,CAAC,gBAAgB;AACnB,WAAO;AAAA,MACL,YAAY;AAAA,MACZ,SAAS;AAAA,MACT,MAAM,KAAK,UAAU;AAAA,QACnB,OACE;AAAA,MACJ,CAAC;AAAA,IACH;AAAA,EACF;AAEA,MAAI;AACJ,MAAI;AACF,WAAO,KAAK,MAAM,MAAM,QAAQ,IAAI;AAAA,EACtC,QAAQ;AACN,WAAO;AAAA,MACL,YAAY;AAAA,MACZ,SAAS;AAAA,MACT,MAAM,KAAK,UAAU,EAAE,OAAO,oBAAoB,CAAC;AAAA,IACrD;AAAA,EACF;AAEA,QAAM,WAAW,KAAK,YAAY,CAAC;AAEnC,MAAI;AACF,UAAM,YAAY,MAAM;AAAA,MACtB;AAAA,MACA;AAAA,QACE,QAAQ;AAAA,QACR,SAAS;AAAA,UACP,gBAAgB;AAAA,UAChB,eAAe,UAAU,cAAc;AAAA,QACzC;AAAA,QACA,MAAM,KAAK,UAAU;AAAA,UACnB,OAAO;AAAA,UACP;AAAA,UACA,YAAY;AAAA,UACZ,aAAa;AAAA,QACf,CAAC;AAAA,MACH;AAAA,IACF;AAEA,UAAM,UAAU,MAAM,UAAU,KAAK;AAErC,QAAI,CAAC,UAAU,IAAI;AACjB,cAAQ,MAAM,iBAAiB,UAAU,QAAQ,OAAO;AACxD,aAAO;AAAA,QACL,YAAY,UAAU;AAAA,QACtB,SAAS;AAAA,QACT,MAAM,WAAW,KAAK,UAAU,EAAE,OAAO,eAAe,CAAC;AAAA,MAC3D;AAAA,IACF;AAEA,QAAI;AACJ,QAAI;AACF,aAAO,KAAK,MAAM,OAAO;AAAA,IAC3B,SAAS,KAAK;AACZ,cAAQ,MAAM,8BAA8B,KAAK,OAAO;AACxD,aAAO;AAAA,QACL,YAAY;AAAA,QACZ,SAAS;AAAA,QACT,MAAM,KAAK,UAAU;AAAA,UACnB,OAAO;AAAA,QACT,CAAC;AAAA,MACH;AAAA,IACF;AAEA,UAAM,OAAO,MAAM,UAAU,CAAC,GAAG,SAAS,WAAW;AAErD,WAAO;AAAA,MACL,YAAY;AAAA,MACZ,SAAS,EAAE,gBAAgB,oBAAoB,GAAG,YAAY;AAAA,MAC9D,MAAM,KAAK,UAAU,EAAE,KAAK,CAAC;AAAA,IAC/B;AAAA,EACF,SAAS,KAAK;AACZ,YAAQ,MAAM,mBAAmB,GAAG;AACpC,WAAO;AAAA,MACL,YAAY;AAAA,MACZ,SAAS,EAAE,gBAAgB,oBAAoB,GAAG,YAAY;AAAA,MAC9D,MAAM,KAAK,UAAU;AAAA,QACnB,OAAO,IAAI,WAAW;AAAA,MACxB,CAAC;AAAA,IACH;AAAA,EACF;AACF;",
  "names": []
}
